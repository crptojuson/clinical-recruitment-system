# 报名申请页面优化

## 🎯 改进概述

对报名申请页面进行了全面优化，提供更完整的信息收集、智能验证和推荐功能。

## ✨ 新增功能

### 1. 完整的个人信息收集
- **基本信息**：姓名、手机号、身份证号、性别
- **身体信息**：身高、体重（自动计算BMI）
- **健康信息**：吸烟状态、疾病史、详细病史、用药情况、过敏史
- **联系信息**：详细地址、紧急联系人及电话

### 2. 智能计算与验证
- **自动计算年龄**：根据身份证号自动计算年龄
- **自动识别性别**：从身份证号自动获取性别信息
- **BMI计算**：实时计算BMI值并显示健康状态
- **资格检查**：自动验证是否符合试验入选条件
  - 年龄要求检查
  - BMI范围检查
  - 性别要求检查

### 3. 疾病史管理
- **常见疾病选择**：提供20种常见疾病的勾选列表
- **详细病史描述**：支持文本输入详细医疗信息
- **当前用药情况**：记录正在服用的药物
- **过敏史记录**：记录过敏信息

### 4. 推荐功能
- **推荐链接生成**：为代理用户生成专属推荐链接
- **一键复制**：方便分享推荐链接
- **推荐奖励显示**：清晰展示推荐奖励金额
- **推荐关系处理**：自动记录推荐关系

### 5. 用户体验优化
- **现代化UI设计**：采用卡片式布局，清晰美观
- **实时反馈**：实时显示计算结果和验证状态
- **智能提示**：提供有用的提示信息
- **表单验证**：全面的客户端验证
- **响应式设计**：适配各种屏幕尺寸

## 🗂️ 数据库更新

### 新增字段

#### User表
- `smokingStatus`：吸烟状态（不吸烟、偶尔吸烟、经常吸烟、已戒烟）
- `diseases`：疾病史（JSON格式存储）

#### Application表
- `smokingStatus`：申请时的吸烟状态
- `diseases`：申请时的疾病史

### 数据库更新命令
```bash
cd backend
npm run update-db
```

## 🚀 使用说明

### 1. 启动系统
```bash
# 后端
cd backend
npm install
npm run update-db  # 首次运行需要更新数据库
npm run dev

# 前端
cd frontend
npm install
npm run dev
```

### 2. 功能特点

#### 自动计算功能
- 输入身份证号后自动识别性别和计算年龄
- 输入身高体重后自动计算BMI
- 实时显示健康状态（偏瘦/正常/偏胖/肥胖）

#### 资格验证
- 根据试验要求实时检查参与资格
- 不符合条件时禁止提交并显示具体原因
- 支持的验证条件：
  - 年龄范围
  - BMI范围
  - 性别要求

#### 推荐系统
- 代理用户可生成推荐链接
- 访问推荐链接的用户报名时自动关联推荐关系
- 支持推荐奖励显示和复制分享

#### 疾病史管理
- 提供常见疾病快速选择
- 支持详细病史文本描述
- 记录当前用药和过敏情况

## 🔧 技术实现

### 前端改进
- 使用React Hook Form进行表单管理
- 实时计算和验证逻辑
- 优化的UI组件和交互设计
- 响应式布局适配

### 后端改进
- 扩展数据模型支持新字段
- 增强申请处理逻辑
- 推荐关系自动处理
- 数据验证和错误处理

### 数据验证
- 身份证号格式验证
- 手机号格式验证
- 数值范围验证
- 必填字段验证

## 📋 表单字段说明

### 必填字段
- 姓名
- 手机号（不可修改）
- 身份证号
- 性别（自动识别）
- 身高、体重
- 详细地址
- 紧急联系人及电话
- 吸烟状态

### 可选字段
- 疾病史选择
- 详细病史描述
- 当前用药情况
- 过敏史

## 🎨 UI/UX 改进

### 视觉设计
- 卡片式布局，层次清晰
- 图标配合文字，直观易懂
- 颜色编码的状态显示
- 渐变背景的推荐功能区

### 交互设计
- 实时反馈和计算
- 智能表单验证
- 一键复制功能
- 折叠式推荐链接显示

### 响应式设计
- 移动端适配
- 平板端优化
- 桌面端完整功能

## 🔐 安全性

- 身份证号格式严格验证
- 手机号验证
- 数据传输加密
- 推荐关系防刷机制

## 📊 数据统计

系统会自动统计：
- 申请人员的健康状况分布
- BMI分布情况
- 疾病史统计
- 推荐关系数据

这些改进使得报名申请页面更加专业、完整和用户友好，能够收集到进行临床试验所需的完整信息，同时提供良好的用户体验。 